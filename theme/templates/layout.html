{{- $isHome := eq .Page.Type "home" -}}
{{- $homePath := printf "%s/" .BaseURL -}}
{{- $docsTitle := "Documentation" -}}
{{- $searchLabel := "Search" -}}
{{- $brandName := "Notepub" -}}
{{- $brandLogo := printf "%s/notepub.svg" .AssetsBase -}}
{{- $defaultOGImage := printf "%s/notepub.jpg" .AssetsBase -}}
{{- $metaOGImage := "" -}}
{{- $metaOGImageAlt := "" -}}
{{- $fmOverridesOGImage := false -}}
{{- with .Collections.home_page.Items -}}
  {{- if gt (len .) 0 -}}
    {{- $brandName = (index . 0).Title -}}
  {{- end -}}
{{- end -}}
{{- range .Meta.OpenGraph -}}
  {{- if eq .Key "og:image" -}}
    {{- $metaOGImage = .Value -}}
  {{- end -}}
  {{- if eq .Key "og:image:alt" -}}
    {{- $metaOGImageAlt = .Value -}}
  {{- end -}}
{{- end -}}
{{- with (index .FM "og_image") -}}
  {{- if ne (printf "%v" .) "" -}}
    {{- $fmOverridesOGImage = true -}}
  {{- end -}}
{{- end -}}
{{- with (index .FM "opengraph") -}}
  {{- with (index . "image") -}}
    {{- if ne (printf "%v" .) "" -}}
      {{- $fmOverridesOGImage = true -}}
    {{- end -}}
  {{- end -}}
{{- end -}}
{{- with (index .FM "og") -}}
  {{- with (index . "image") -}}
    {{- if ne (printf "%v" .) "" -}}
      {{- $fmOverridesOGImage = true -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="light" />
  <meta name="theme-color" content="#ffffff" />
  <link rel="apple-touch-icon" sizes="180x180" href="{{ .AssetsBase }}/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="{{ .AssetsBase }}/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="{{ .AssetsBase }}/favicon-16x16.png" />
  <link rel="icon" href="{{ .AssetsBase }}/favicon.ico" />
  <link rel="mask-icon" href="{{ .AssetsBase }}/notepub.svg" color="#0a0a0a" />
  <link rel="manifest" href="{{ .AssetsBase }}/site.webmanifest" />
  <link rel="stylesheet" href="{{ .AssetsBase }}/styles.css" />
  {{- if .Page.Description }}
  <meta name="description" content="{{ .Page.Description }}" />
  {{- end }}
  {{- if .Meta.Robots }}
  <meta name="robots" content="{{ .Meta.Robots }}" />
  {{- end }}
  {{- if .Canonical }}
  <link rel="canonical" href="{{ .Canonical }}" />
  {{- end }}
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="{{ .Title }}" />
  {{- if .Page.Description }}
  <meta name="twitter:description" content="{{ .Page.Description }}" />
  {{- end }}
  {{- range .Meta.OpenGraph }}
  {{- if and (ne .Key "og:image") (ne .Key "og:image:alt") }}
  <meta property="{{ .Key }}" content="{{ .Value }}" />
  {{- end }}
  {{- end }}
  {{- $resolvedOGImage := $defaultOGImage -}}
  {{- if and (eq .Page.Type "article") (ne $metaOGImage "") -}}
    {{- $resolvedOGImage = $metaOGImage -}}
  {{- end -}}
  {{- if and (ne .Page.Type "article") $fmOverridesOGImage (ne $metaOGImage "") -}}
    {{- $resolvedOGImage = $metaOGImage -}}
  {{- end -}}
  <meta property="og:image" content="{{ $resolvedOGImage }}" />
  {{- if and (eq $resolvedOGImage $metaOGImage) (ne $metaOGImageAlt "") }}
  <meta property="og:image:alt" content="{{ $metaOGImageAlt }}" />
  {{- end }}

  {{- if .Meta.JSONLD }}
  <script type="application/ld+json">{{ .Meta.JSONLD }}</script>
  {{- else }}
  {{- $pageURL := .Canonical -}}
  {{- if not $pageURL }}{{- $pageURL = printf "%s/" .BaseURL -}}{{- end -}}
  {{- $isArticle := eq .Page.Type "article" -}}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "WebSite",
        "@id": "{{ .BaseURL }}/#website",
        "url": "{{ .BaseURL }}/",
        "name": "Notepub Docs Template",
        "inLanguage": "en"
      },
      {
        "@type": "WebPage",
        "@id": "{{ $pageURL }}#webpage",
        "url": "{{ $pageURL }}",
        "name": "{{ .Title }}",
        "description": "{{ .Page.Description }}",
        "isPartOf": { "@id": "{{ .BaseURL }}/#website" },
        "inLanguage": "en"
      }
      {{- if $isArticle -}},
      {
        "@type": "TechArticle",
        "headline": "{{ .Title }}",
        "description": "{{ .Page.Description }}",
        "mainEntityOfPage": { "@id": "{{ $pageURL }}#webpage" },
        "inLanguage": "en"
      }
      {{- end -}}
    ]
  }
  </script>
  {{- end }}

  {{- if not $isHome }}
  {{- $crumbPageURL := .Canonical -}}
  {{- if not $crumbPageURL }}{{- $crumbPageURL = printf "%s/" .BaseURL -}}{{- end -}}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {
        "@type": "ListItem",
        "position": 1,
        "name": "Home",
        "item": "{{ $homePath }}"
      },
      {
        "@type": "ListItem",
        "position": 2,
        "name": "{{ .Title }}",
        "item": "{{ $crumbPageURL }}"
      }
    ]
  }
  </script>
  {{- end }}

  <script>
    window.__notepubSearchMode = "{{ .SearchMode }}";
    window.__notepubBaseURL = "{{ .BaseURL }}";
  </script>
  <title>{{ .Title }}</title>
</head>

<body class="{{ if $isHome }}is-home{{ else }}is-page{{ end }}">
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="{{ $homePath }}" aria-label="{{ $brandName }}">
        <span class="logo" aria-hidden="true">
          <img src="{{ $brandLogo }}" alt="" />
        </span>
        <span>{{ $brandName }}</span>
      </a>
      <div class="header-actions">
        <a id="np-search-trigger" class="icon-button" href="{{ .BaseURL }}/search" aria-label="{{ $searchLabel }}">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="icon" viewBox="0 0 16 16" aria-hidden="true" focusable="false">
            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
          </svg>
        </a>
        <button class="icon-button nav-toggle" type="button" data-nav-open aria-label="Open navigation">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="icon icon-open" viewBox="0 0 16 16" aria-hidden="true" focusable="false">
            <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5"/>
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="icon icon-close" viewBox="0 0 16 16" aria-hidden="true" focusable="false">
            <path d="M2.146 2.146a.5.5 0 0 1 .708 0L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854a.5.5 0 0 1 0-.708"/>
          </svg>
        </button>
      </div>
    </div>
  </header>

  {{- $pages := .Collections.nav_pages.Items }}
  {{- $hubs := .Collections.nav_hubs.Items }}
  {{- $groups := .Collections.nav_articles_by_hub.Groups }}

  <aside class="mobile-nav" data-nav-panel aria-hidden="true">
    <div class="mobile-nav-inner">
      <nav class="mobile-nav-links mobile-docs-nav" aria-label="Documentation navigation">
        <ul class="sidebar-list">
          <li class="sidebar-group">
            <a class="{{ if eq $.Page.Type "home" }}is-active{{ end }}" href="{{ $homePath }}">{{ $docsTitle }}</a>
          </li>
          {{- if $pages }}
            <li class="sidebar-group">
              <ul class="sidebar-sublist sidebar-root">
                {{- range $pages }}
                <li><a class="{{ if eq .Slug $.Page.Slug }}is-active{{ end }}" href="{{ printf "%s%s" $.BaseURL .Path }}">{{ .Title }}</a></li>
                {{- end }}
              </ul>
            </li>
          {{- end }}
          {{- if $hubs }}
            {{- range $hubs }}
            {{- $hub := . }}
            <li class="sidebar-group">
              <a class="{{ if eq $hub.Slug $.Page.Slug }}is-active{{ end }}" href="{{ printf "%s%s" $.BaseURL $hub.Path }}">{{ $hub.Title }}</a>
              {{- if $groups }}
              <ul class="sidebar-sublist">
                {{- range $groups }}
                  {{- if eq .Key $hub.Slug }}
                    {{- range .Items }}
                    <li><a class="{{ if eq .Slug $.Page.Slug }}is-active{{ end }}" href="{{ printf "%s%s" $.BaseURL .Path }}">{{ .Title }}</a></li>
                    {{- end }}
                  {{- end }}
                {{- end }}
              </ul>
              {{- end }}
            </li>
            {{- end }}
          {{- end }}
        </ul>
      </nav>
    </div>
    <div class="mobile-nav-backdrop" data-nav-close></div>
  </aside>

  <main class="wrap">
    <div class="layout">
      <aside class="sidebar" aria-label="Documentation navigation">
        <ul class="sidebar-list">
          <li class="sidebar-group">
            <a class="{{ if eq $.Page.Type "home" }}is-active{{ end }}" href="{{ $homePath }}">{{ $docsTitle }}</a>
          </li>
          {{- if $pages }}
            <li class="sidebar-group">
              <ul class="sidebar-sublist sidebar-root">
                {{- range $pages }}
                <li><a class="{{ if eq .Slug $.Page.Slug }}is-active{{ end }}" href="{{ printf "%s%s" $.BaseURL .Path }}">{{ .Title }}</a></li>
                {{- end }}
              </ul>
            </li>
          {{- end }}
          {{- if $hubs }}
            {{- range $hubs }}
            {{- $hub := . }}
            <li class="sidebar-group">
              <a class="{{ if eq $hub.Slug $.Page.Slug }}is-active{{ end }}" href="{{ printf "%s%s" $.BaseURL $hub.Path }}">{{ $hub.Title }}</a>
              {{- if $groups }}
              <ul class="sidebar-sublist">
                {{- range $groups }}
                  {{- if eq .Key $hub.Slug }}
                    {{- range .Items }}
                    <li><a class="{{ if eq .Slug $.Page.Slug }}is-active{{ end }}" href="{{ printf "%s%s" $.BaseURL .Path }}">{{ .Title }}</a></li>
                    {{- end }}
                  {{- end }}
                {{- end }}
              </ul>
              {{- end }}
            </li>
            {{- end }}
          {{- end }}
        </ul>
      </aside>
      <div class="content-area">
        {{- if not $isHome }}
        <nav class="breadcrumb" aria-label="Breadcrumb">
          <a href="{{ $homePath }}">Home</a>
          <span>/</span>
          <span>{{ .Title }}</span>
        </nav>
        {{- end }}
        {{ .Body }}
      </div>
    </div>
  </main>

  {{ template "search_trigger.html" . }}

  <footer class="site-footer">
    <div class="container footer-inner">
      <span class="footer-built muted">Built with <a class="is-external" href="https://cookiespooky.github.io/np/">Notepub</a></span>
    </div>
  </footer>
  <script src="{{ .AssetsBase }}/main.js"></script>
</body>
</html>
